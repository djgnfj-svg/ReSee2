{% extends 'base.html' %}
{% load static %}
{% block title %}로그인 / 회원가입 폼 템플릿{% endblock %}
{% block head %}

{% endblock %}
{% block content %}
<script>
  var link = document.location.href.split("/")[4];
  $.ajax({
    type: "GET",
    url: "/api/category_list/" + link + "/study_list",
    dataType: 'json',
    success: function (json) {
      for (i = 0; i < json.length; i++) {
        $("#study_board").append(" " +
          "<tr>" +
          "<th scope='row'>" + json[i].id + "</th>" +
          "<td>" +
          "<li class='menu'>" +
          "<a href='/category_list/" + link + "/study_list/"+json[i].id+"'>" + json[i].study_title + "</a>" +
          "</li>" +
          "</td>" +
          "<td>" + json[i].updated_at + "</td>" +
          "<td>" +
          "<a>" +
          "<button style='background-color:black; width: 100px; height: 35px;" +
          "color: white; border: 1px solid; border-radius: 0.5rem 0.5rem 0.5rem 0.5rem;'>" +
          "내용보기" +
          "</button>" +
          "<a id='clear"+json[i].id+"' href='#'  onclick='reply_click(this.id)'>"+
          "<img src= {% static 'img/clear.png' %}>"+  
          "</a>"+
          "</a>" +
          "</td>" +
          "</tr>"
        )
      }
    }
  });
</script>
<style>
  .menu a {
    cursor: pointer;
  }

  .menu .hide {
    display: none;
  }

  ul {
    list-style: none;
    padding-left: 0%;
    float: left;
  }

  li {
    list-style: none;
    float: left;
  }
</style>
<header style="font-weight: bold; font-size: 30px; margin-top: 1%; margin-left: 3%; margin-bottom: 1%;">
  Study_list
</header>
<div style="text-align: right; margin-right: 20%;">
  <button onclick="create_study()">Add</button>
</div>
<div style="margin-left: 15vw; margin-right: 15vw;">
  <table class="table align-items-center table-flush">
    <thead class="thead-light">
      <tr>
        <th scope="col">No</th>
        <th scope="col">Title</th>
        <th scope="col">Last_ReSee</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody id=study_board>


    </tbody>
  </table>

</div>
<script>
  var link = document.location.href.split("/")[4];
  let str=clicked_id.split("clear")[1]

  function create_study(){
    location.href="/category_list/" + link + "/study_list/create"
  }

  function reload(){
    window.location.reload()
  }

  function reply_click(clicked_id) {
      $.ajax({
        method: "DELETE",
        url: "/api/category_list/" + link + "/study_list/"+str+"/",
        dataType: "json",
        headers: {
          'X-CSRFTOKEN': '{{ csrf_token }}'
        },
        success: function (json) {
          alert("삭제 성공!");
          reload();
        },
        error: function ( error ) {
          alert(" error = " + error); // 실패 시 처리
        },
    });
  }
  
</script>
{% endblock %}